<!DOCTYPE html>
<html  >
<head>
  
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  <link rel="shortcut icon" href="assets/images/15018162-128x128.png" type="image/x-icon">
  <meta name="description" content="">
  
  
  <title>NGRX entity</title>
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons2/mobirise2.css">
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css">
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/socicon/css/styles.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Jost:100,200,300,400,500,600,700,800,900,100i,200i,300i,400i,500i,600i,700i,800i,900i&display=swap"></noscript>
  <link rel="preload" as="style" href="assets/mobirise/css/mbr-additional.css?v=7gXzbW"><link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css?v=7gXzbW" type="text/css">

  
  <link href="prism.css" rel="stylesheet" />
<!-- include A-Frame obviously -->
<script src="aframe.min.js"></script>
<!-- include ar.js for A-Frame -->
<script src="aframe-ar.js"></script>



  
</head>
<body>
  
  <section data-bs-version="5.1" class="menu menu3 cid-twlFBWjt0N" once="menu" id="menu3-4ii">
    
    <nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg">
        <div class="container">
            <div class="navbar-brand">
                
                <span class="navbar-caption-wrap"><a class="navbar-caption text-black text-primary display-7" href="index.html">Neil Haddley</a></span>
            </div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbarSupportedContent" data-bs-target="#navbarSupportedContent" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true"><li class="nav-item"><a class="nav-link link text-black text-primary display-4" href="posts.html">
                            Blog Posts</a></li></ul>
                <div class="icons-menu">
                    <a class="iconfont-wrapper" href="https://www.linkedin.com/in/neil-haddley/" target="_blank">
                        <span class="p-2 mbr-iconfont socicon-linkedin socicon"></span>
                    </a>
                    <a class="iconfont-wrapper" href="https://github.com/haddley" target="_blank">
                        <span class="p-2 mbr-iconfont mbrib-github"></span>
                    </a>
                    <a class="iconfont-wrapper" href="https://www.npmjs.com/~haddley" target="_blank">
                        <span class="p-2 mbr-iconfont socicon-npm socicon"></span>
                    </a>
                    <a class="iconfont-wrapper" href="https://hub.docker.com/u/haddley" target="_blank">
                        <span class="p-2 mbr-iconfont mobi-mbri-delivery mobi-mbri"></span>
                    </a>
                </div>
                
            </div>
        </div>
    </nav>
</section>

<section class="content4 cid-twlFBX7vDP" id="content4-4ij">
    
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="title col-md-12 col-lg-10">
                <h3 class="mbr-section-title mbr-fonts-style align-center mb-4 display-2"><strong>NGRX entity</strong></h3>
                <h4 class="mbr-section-subtitle align-center mbr-fonts-style mb-4 display-5">Managing record collections</h4>
                
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twlFBXsBzL" id="image3-4ik">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/ngrx.svg" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4"><a rel="nofollow" href="https://github.com/immersive-web/webxr/blob/main/images/spec-logo.png"><br></a><a href="https://ngrx.io/presskit" class="text-primary" target="_blank">This file is licensed under the Creative Commons 4.0.</a><br></p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-twlFBXDQHY" id="content5-4il">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">json-server</h4>
                <p class="mbr-text mbr-fonts-style display-7">I extended my haddley-ngrx project to include support for posts.<br><br>I used json-server to create a simple api<br><br><strong>%&nbsp;npm i json-server<br></strong><br></p>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twlHFcfQG3" id="image3-4j2">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-3.21.40-pm-1536x284.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">npm i json-server</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twlHGdGiV1" id="image3-4j4">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-3.22.53-pm-1536x503.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Github co-pilot suggested an addition to the scripts section of package.json</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twlHFxsDfY" id="image3-4j3">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-3.26.07-pm-1536x676.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">I created a db.json in the project's root folder</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twlHGzqRfx" id="image3-4j5">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-3.27.45-pm-1536x717.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">I started the server by running <strong>npm run server</strong></p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twlHHhCCvM" id="image3-4j7">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-3.28.45-pm-1420x744.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">I used chrome to request details of all posts.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-twm4IJKXfD" id="content5-4jw">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Accessing the server</h4>
                <p class="mbr-text mbr-fonts-style display-7"></p>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4sJyb93" id="image3-4jb">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-4.11.54-pm-1536x433.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">ng generate service services/post</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4tpZFCR" id="image3-4jc">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-4.13.08-pm-1536x913.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">ng test</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4tDaMrJ" id="image3-4jd">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-4.16.26-pm-1536x356.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">providedIn: 'root' (no need to add service to app.module.ts)</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4ub78Te" id="image3-4je">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-4.21.24-pm-1536x574.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">co-pilot suggests creating a post.model file (why not?)</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4uXufgM" id="image3-4jg">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-4.23.22-pm-1536x351.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">co-pilot suggests that we include a body field (why not?)</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4vSJrRA" id="image3-4ji">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-5.21.38-pm-1536x615.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">co-pilot suggests that we include a deletePost method (why not)</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twmiVWpGDP" id="content7-4jz">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>post.service.ts</strong></h5>

<pre class="language-clike"><code><!--         
import { Injectable } from '@angular/core';
import { Post } from '../models/post.model';
import { Observable } from 'rxjs';
import { HttpClient } from '@angular/common/http';


@Injectable({
  providedIn: 'root'
})
export class PostService {
  
  constructor(private http:HttpClient) { }

  getPosts(): Observable<Post[]> {
    return this.http.get<Post[]>('http://localhost:3000/posts');
  }

  deletePost(id: number): Observable<Post> {
    return this.http.delete<Post>(`http://localhost:3000/posts/${id}`);
  }

  addPost(post: Post): Observable<Post> {
    return this.http.post<Post>('http://localhost:3000/posts', post);
  }

  updatePost(post: Post): Observable<Post> {
    return this.http.put<Post>(`http://localhost:3000/posts/${post.id}`, post);
  }

  getPost(id: number): Observable<Post> {
    return this.http.get<Post>(`http://localhost:3000/posts/${id}`);
  }
  
}

--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4wflhBt" id="image3-4jj">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-19-at-6.33.32-pm-1536x552.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">imports HttpClientModule</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-twpKSqrk9P" id="content5-4k0">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Testing a service</h4>
                <p class="mbr-text mbr-fonts-style display-7">Initially I wrote tests that called the running json-server.<br><br></p>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twqf0DW1MR" id="image3-4k1">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-10.33.14-am-1536x746.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Executed 6 of 6 success</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twqfnuxtkM" id="content7-4k3">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>post.service.spec.ts</strong></h5>

<pre class="language-clike"><code><!--         
import { HttpClientModule } from '@angular/common/http';
import { TestBed } from '@angular/core/testing';
import { PostService } from './post.service';

describe('PostService', () => {
  let service: PostService;

  beforeEach(() => {
    TestBed.configureTestingModule({ imports: [HttpClientModule] });
    service = TestBed.inject(PostService);
  });

  it('should be created', () => {
    expect(service).toBeTruthy();
  });

  it('getPost(1) should return { id: 1, title: "json-server", author: "typicode", body: "some body" } from observable',
    (done: DoneFn) => {
      service.getPost(1).subscribe(value => {
        expect(value).toEqual({ id: 1, title: "json-server", author: "typicode", body: "some body" });
        done();
      });
    });

  it('addPost({ id: 100,...}) and deletePost(100) should return Truthy',
    (done: DoneFn) => {
      service.addPost({ id: 100, title: "json-server100", author: "typicode", body: "some body100" }).subscribe(value => {
        expect(value).toBeTruthy();
        service.deletePost(100).subscribe(value => {
          expect(value).toBeTruthy();
          done();
        });
      });
    });

});




--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4wMhd9x" id="image3-4jk">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-10.32.47-am-1536x849.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Karma results in a web page</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twqf1WIMwG" id="image3-4k2">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-10.33.29-am-1536x846.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">The json-server shows the POST, DELETE and GET requests</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-twqjxOkIsW" id="content5-4k4">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Mock the HTTP client</h4>
                <p class="mbr-text mbr-fonts-style display-7">I&nbsp;installed jasmine-auto-spies.<br><br><strong>% npm i --include=dev jasmine-auto-spies</strong><br><br>I updated the tests to use the mock.</p>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4xf7hNQ" id="image3-4jl">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-10.56.26-am-1536x141.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">npm i --include=dev jasmine-auto-spies</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4xHh55t" id="image3-4jm">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-11.32.27-am-1536x782.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Executed 6 of 6 success</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twqueecRk0" id="content7-4k5">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>post.service.spec.ts</strong></h5>

<pre class="language-clike"><code><!--         
import { HttpClient, HttpErrorResponse } from '@angular/common/http';
import { createSpyFromClass, Spy } from 'jasmine-auto-spies';
import { Post } from '../models/post.model';
import { PostService } from './post.service';
import { TestBed } from '@angular/core/testing';

describe('PostService', () => {
  let service: PostService;
  let httpSpy: Spy<HttpClient>;

  beforeEach(() => {
    TestBed.configureTestingModule({
      providers: [
        PostService,
        { provide: HttpClient, useValue: createSpyFromClass(HttpClient) }
      ]
    });

    service = TestBed.inject(PostService);
    httpSpy = TestBed.inject<any>(HttpClient);
  });

  it('should create a new post', (done: DoneFn) => {

    const newPost = { id: 100, title: "json-server100", author: "typicode", body: "some body100" } as Post;

    httpSpy.post.and.nextWith(newPost);

    service.addPost(newPost).subscribe(post => {
      expect(post).toEqual(newPost);
      done();
    });
    expect(httpSpy.post.calls.count()).toBe(1);
  });

  it('should return an existing post', (done: DoneFn) => {

    const existingPost = { id: 1, title: "json-server", author: "typicode", body: "some body" } as Post;
    const postId = existingPost.id;

    httpSpy.get.and.nextWith(existingPost);

    service.getPost(postId).subscribe(post => {
      expect(post).toEqual(existingPost);
      done();
    });

    expect(httpSpy.get.calls.count()).toBe(1);
  });

  it('should return a 404 if post does not exist', (done: DoneFn) => {

    const postId = 89776683;

    httpSpy.get.and.throwWith(new HttpErrorResponse({
      error: "404 - Not Found",
      status: 404
    }));

    service.getPost(postId).subscribe({
      next: (post) => {
        done.fail("Expected a 404");
      },
      error: (error) => {
        expect(error.status).toEqual(404);
        done();
      }
    });

    expect(httpSpy.get.calls.count()).toBe(1);
  });


});

--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4y7iZev" id="image3-4jn">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-11.32.46-am-1536x486.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Karma results in a web page</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="content5 cid-twrjG7pxJi" id="content5-4k6">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-12 col-lg-10">
                
                <h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">NGRX Entity</h4>
                <p class="mbr-text mbr-fonts-style display-7">Entity provides an API to manipulate and query entity collections.<br><br>Reduces boilerplate for creating reducers that manage a collection of models.<br>Provides performant CRUD operations for managing entity collections.<br>Extensible type-safe adapters for selecting entity information.<br></p>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twrk0yyhaZ" id="content7-4k7">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>post.actions.ts</strong></h5>

<pre class="language-clike"><code><!--         
import { createAction, props } from '@ngrx/store';
import { Post } from 'src/app/models/post.model';

export const loadPosts = createAction('[Posts] Load Posts');
export const loadPostsSuccess = createAction('[Posts] Load Posts Success', props<{ posts: Post[] }>());
export const loadPostsFailure = createAction('[Posts] Load Posts Failure', props<{ error: string }>());
--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twrk19WmmB" id="content7-4k8">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>post.effect.ts</strong></h5>

<pre class="language-clike"><code><!--         
import { Injectable } from "@angular/core";
import { catchError, exhaustMap, map, of } from "rxjs";
import { loadPosts, loadPostsFailure, loadPostsSuccess } from "./post.actions";
import { Actions, createEffect, ofType } from "@ngrx/effects";
import { PostService } from "src/app/services/post.service";

@Injectable()
export class PostEffects {

    constructor(private actions$: Actions, private postService: PostService) { }

    loadPosts$ = createEffect(() =>
        this.actions$.pipe(
            ofType(loadPosts),
            exhaustMap(() =>
                // call the service
                this.postService.getPosts().pipe(
                    // return a Success action when the HTTP request was successfull
                    map((posts) => loadPostsSuccess({ posts: posts })),
                    // return a Failed action when something went wrong during the HTTP request
                    catchError((error) => of(loadPostsFailure({ error: 'http error' }))),
                ),
            ),
        )
    );
}
--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twrk1JZ0xW" id="content7-4k9">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>post.reducer.ts</strong></h5>

<pre class="language-clike"><code><!--         
import {
    createEntityAdapter,
    EntityAdapter,
    EntityState
} from '@ngrx/entity';
import { Post } from '../../models/post.model';
import { createReducer, on } from '@ngrx/store';
import { loadPostsFailure, loadPostsSuccess } from './post.actions';

export interface PostState extends EntityState<Post> {
    // additional entities state properties
    currentPostId: number | null;
    error: any;
}

export const postAdapter: EntityAdapter<Post> = createEntityAdapter<Post>();

export const initialState: PostState = postAdapter.getInitialState({
    currentPostId: null,
    error: null
});

export const postReducer = createReducer(
    initialState,
    on(loadPostsSuccess, (state, { posts }) => {
        return postAdapter.setAll(posts, {...state,error:null});
    }),
    on(loadPostsFailure, (state, { error }) => {
        return { ...state, error};
    })

)
--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twrk2devHu" id="content7-4ka">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>post.selector.ts</strong></h5>

<pre class="language-clike"><code><!--         
import { createSelector } from "@ngrx/store";
import { AppState } from "../app.state";
import { postAdapter, PostState } from "./post.reducer";

export const selectPosts = (state: AppState) => state.posts;

export const { selectIds, selectEntities, selectAll, selectTotal } = postAdapter.getSelectors();

export const selectAllPosts = createSelector(selectPosts, selectAll);

export const selectEntitiesPosts = createSelector(selectPosts, selectEntities);

export const selectTotalPosts = createSelector(selectPosts, selectTotal);

export const selectIdsPosts = createSelector(selectPosts, selectIds);

export const selectError = createSelector(
    selectPosts,
    (state: PostState) => state.error
);
--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twrk2IKz0M" id="content7-4kb">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>app.component.html</strong></h5>

<pre class="language-clike"><code><!--         
<div class="dice" (click)="updateValue()" *ngIf="value$|async as value">{{value}}</div>

<div *ngIf="postsError$ | async as postsError; else loaded">
    <p>There was an error loading the posts</p>
    <p>{{postsError}}</p>
</div>

<ng-template #loaded>
    <table>
        <thead>
            <th>Title</th>
            <th>Author</th>
            <th>Body</th>
        </thead>
        <tbody>
            <tr *ngFor="let post of posts$ | async">
                <td>{{post.title}}</td>
                <td>{{post.author}}</td>
                <td>{{post.body}}</td>
            </tr>
        </tbody>
    </table>
</ng-template>
--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="content7 cid-twrlFNVHoy" id="content7-4kc">
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10">
                <blockquote>
                <h5 class="mbr-section-title mbr-fonts-style mb-2 display-7"><strong>app.component.ts</strong></h5>

<pre class="language-clike"><code><!--         
import { Component, OnInit } from '@angular/core';
import { selectDiceError } from './state/dice/dice.selectors';
import { selectDiceValue } from './state/dice/dice.selectors';
import { Store } from '@ngrx/store';
import { roll} from './state/dice/dice.actions';
import { AppState } from './state/app.state';
import { selectAllPosts, selectEntitiesPosts, selectTotalPosts, selectIdsPosts, selectError } from './state/post/post.selector';
import { loadPosts } from './state/post/post.actions';

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.scss']
})
export class AppComponent implements OnInit {

    // random number beteen 1 and 6
    value$ = this.appStore.select(selectDiceValue);
    error$ = this.appStore.select(selectDiceError);

    // posts
    posts$ = this.appStore.select(selectAllPosts);
    postsError$ = this.appStore.select(selectError);

  constructor(private appStore: Store<AppState>) {}

  updateValue() {
    this.appStore.dispatch(roll());
  }

  ngOnInit() {
    this.appStore.dispatch(loadPosts());
  }

  title = 'haddley-ngrx';

}

--></code></pre>
                    

                    
</blockquote>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4z1WDTW" id="image3-4jp">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-3.08.35-pm-1536x498.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Load Posts Success</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="image3 cid-twm4zvspEd" id="image3-4jq">
    

    

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">
                <div class="image-wrapper">
                    <img src="assets/images/screen-shot-2023-02-20-at-3.09.38-pm-1536x476.png" alt="">
                    <p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Load Posts Failure (service not running)</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="features13 cid-twlFBZSjbl" id="features14-4iz">
    

    
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h3 class="mbr-section-title align-center mb-4 mbr-fonts-style display-2"><strong>References</strong></h3>
            </div>
            <div class="card col-12 col-md-4 col-lg-2 p-3">
                <div class="card-wrapper">
                    <div class="card-box align-center">
                        <span class="mbr-iconfont mbri-pages"></span>
                        <h4 class="card-title align-center mbr-black mbr-fonts-style display-7"><strong><a href="https://github.com/Haddley/haddley-ngrx" class="text-primary" target="_blank">GitHub repository</a></strong></h4>
                    </div>
                </div>
            </div>
            
            
            
            
            
        </div>
    </div>
</section>


<script src="assets/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/smoothscroll/smooth-scroll.js"></script>
  <script src="assets/ytplayer/index.js"></script>
  <script src="assets/dropdown/js/navbar-dropdown.js"></script>
  <script src="assets/theme/js/script.js"></script>
  
  <script src="prism.js"></script>
<script src="webcomponents/howtoTooltip.js"></script>
  
</body>
</html>