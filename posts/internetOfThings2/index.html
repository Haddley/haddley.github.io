<!DOCTYPE html><!--RJUMHoOpO5HDs1LInqYrA--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/949adacb6381283a-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/9dd75fadc5b3df29-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/a7d33c8790143d66.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-4c42975394ce1617.js"/><script src="/_next/static/chunks/4bd1b696-c023c6e3521b1417.js" async=""></script><script src="/_next/static/chunks/255-fe5c522e6d28d73f.js" async=""></script><script src="/_next/static/chunks/main-app-f50e9b07a96b5107.js" async=""></script><script src="/_next/static/chunks/619-ba102abea3e3d0e4.js" async=""></script><script src="/_next/static/chunks/app/layout-b6140098d4dc0e33.js" async=""></script><script src="/_next/static/chunks/356-1fcf197c11312f1f.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js" async=""></script><meta name="next-size-adjust" content=""/><title>Neil Haddley - Developer &amp; Technical Consultant</title><meta name="description" content="I help organizations to connect with clients, comply with regulations, and automate workflows."/><meta name="author" content="Neil Haddley"/><meta name="keywords" content="developer, consultant, Azure, Angular, Business Central, automation"/><meta name="creator" content="Neil Haddley"/><meta property="og:title" content="Neil Haddley - Developer &amp; Technical Consultant"/><meta property="og:description" content="I help organizations to connect with clients, comply with regulations, and automate workflows."/><meta property="og:url" content="https://haddley.github.io/"/><meta property="og:site_name" content="Neil Haddley"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Neil Haddley - Developer &amp; Technical Consultant"/><meta name="twitter:description" content="I help organizations to connect with clients, comply with regulations, and automate workflows."/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><link rel="stylesheet" href="/assets/web/assets/mobirise-icons2/mobirise2.css"/><link rel="stylesheet" href="/assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css"/><link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css"/><link rel="stylesheet" href="/assets/bootstrap/css/bootstrap-grid.min.css"/><link rel="stylesheet" href="/assets/bootstrap/css/bootstrap-reboot.min.css"/><link rel="stylesheet" href="/assets/dropdown/css/style.css"/><link rel="stylesheet" href="/assets/socicon/css/styles.css"/><link rel="stylesheet" href="/assets/theme/css/style.css"/><link rel="stylesheet" href="/assets/mobirise/css/mbr-additional.css"/><link rel="stylesheet" href="/prism.css"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_2cd903 antialiased"><div hidden=""><!--$--><!--/$--></div><section class="menu menu3 cid-uBU3VPzqgj" id="menu3-crt"><nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg"><div class="container"><div class="navbar-brand"><span class="navbar-caption-wrap"><a class="navbar-caption text-black text-primary display-7" href="/">Neil Haddley</a></span></div><button class="navbar-toggler" type="button" aria-expanded="false" aria-label="Toggle navigation"><div class="hamburger"><span></span><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse " id="navbarSupportedContent"><ul class="navbar-nav nav-dropdown nav-right"><li class="nav-item"><a class="nav-link link text-black text-primary display-4" href="/posts/">Blog Posts</a></li></ul><div class="icons-menu"><a class="iconfont-wrapper" href="https://www.linkedin.com/in/neil-haddley/" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont socicon-linkedin socicon"></span></a><a class="iconfont-wrapper" href="https://github.com/haddley" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont mbrib-github"></span></a><a class="iconfont-wrapper" href="https://www.npmjs.com/~haddley" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont socicon-npm socicon"></span></a><a class="iconfont-wrapper" href="https://hub.docker.com/u/haddley" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont mobi-mbri-delivery mobi-mbri"></span></a></div></div></div></nav></section><main><section class="content4 cid-uBU3VQlp0E" id="content4-cru"><div class="container"><div class="row justify-content-center"><div class="title col-md-12 col-lg-10"><h3 class="mbr-section-title mbr-fonts-style align-center mb-4 display-2"><strong>Internet of Things (Part 2)</strong></h3><h4 class="mbr-section-subtitle align-center mbr-fonts-style mb-4 display-5">A comprehensive guide covering internet of things2</h4></div></div></div></section><section class="content1 cid-content" id="content1-breadcrumb"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class="mb-4"><a class="link text-primary display-7" href="/posts/">← Back to Posts</a></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Node-RED can publish messages to a MQTT broker and subscribe to MQTT topics.</h4></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="iot microchip by Philipp Petzka is licensed under CC" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/iot-microchip.svg"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">iot microchip by Philipp Petzka is licensed under CC</p></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Node-RED</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>Node-RED can be used to publish messages to an MQTT broker.<br/><br/></span><span>Node-RED is able to subscribe to MQTT broker messages.<br/><br/></span><span>**$ docker run -it -p 1880:1880 nodered/node-red**</span></p></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="node-red Docker image" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-04-at-7.46.57-pm-1136x736.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">node-red Docker image</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Connecting Node-RED to the MQTT broker" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.35.48-pm-1836x1045.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Connecting Node-RED to the MQTT broker</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="&quot;mqtt in&quot; node subscribes to &quot;outTopic&quot; messages" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.41.33-pm-1836x1051.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">&quot;mqtt in&quot; node subscribes to &quot;outTopic&quot; messages</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="&quot;debug&quot; node displays the incoming &quot;outTopic&quot; messages on debug panel" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.42.05-pm-1836x1053.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">&quot;debug&quot; node displays the incoming &quot;outTopic&quot; messages on debug panel</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="&quot;mqtt out&quot; node publishes &quot;1&quot; or &quot;0&quot; to the &quot;inTopic&quot; and ESP8266 LED turns on or off." loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.45.34-pm-1836x1040.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">&quot;mqtt out&quot; node publishes &quot;1&quot; or &quot;0&quot; to the &quot;inTopic&quot; and ESP8266 LED turns on or off.</p></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">MQTT topics and payloads</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>In the example above &quot;inTopic&quot; is a command topic and &quot;outTopic&quot; is a topic for telemetry.</span></p></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Command Topics</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>In the example above the ESP8266 microprocessor subscribes to &quot;inTopic&quot; messages and when it sees a message with the payload &quot;1&quot; the builtin LED is turned on.<br/><br/></span><span>In fact dozens or hundreds of IoT devices could subscribe to &quot;inTopic&quot; messages turning on or off together.<br/><br/></span><span>But, what if a developer would like a single ESP8266 device&#x27;s builtin LED to turn on? What if a developer would like to turn on a fan connected to a single ESP8266 device? What if a developer would like to turn off the fans connected to all ESP8266 devices on given floor of a given building?<br/><br/></span><span>Well every device that connects to an MQTT broker has a unique &quot;thing name&quot; (and a unique MQTT client id) but how would the publisher of a control message specify that they wanted to turn off the fan connected to the ESP8266 with a given &quot;thing name&quot;?</span></p></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Topic structure</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>If a device with thing name &quot;thing1&quot; is in conference room 2 on floor 2 of building 3 a developer can arrange for that thing&#x27;s builtin LED to turn off whenever a message with payload &quot;0&quot; is published with this topic:<br/><br/></span><span>**cmd/hvac/building3/floor2/confroom2/thing1/builtinled**<br/><br/></span><span>A developer can arrange for a fan controlled by thing1 to be turned on whenever a message with payload &quot;1&quot; is published with this topic:<br/><br/></span><span>**cmd/hvac/building3/floor2/confroom2/thing1/fan**<br/><br/></span><span>A developer can arrange for fans controlled by all things on floor 2 to be turned off when a message with payload &quot;0&quot; is published with this topic:<br/><br/></span><span>**cmd/hvac/building3/floor2/fan**<br/><br/></span><span>Sample ESP8266 code is shown below.</span></p></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="publishing to &quot;cmd/hvac/building3/floor2/confroom2/thing1/builtinled&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-07-at-11.21.47-am-1836x1106.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">publishing to &quot;cmd/hvac/building3/floor2/confroom2/thing1/builtinled&quot;</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="subscribing to &quot;cmd/hvac/#&#x27;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-07-at-11.35.42-am-1836x1108.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">subscribing to &quot;cmd/hvac/#&#x27;</p></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Response</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>If the publisher of a Command Topic message wants to receive responses they might provide a JSON payload that includes a &quot;session-id&quot; and a &quot;res-topic&quot;. The session-id would be passed to the ESP8266 device so that it can differentiate between commands that are repeated or re-sent over time. The res-topic would be used as the response message&#x27;s topic (it is better not to hardcode the response message&#x27;s topic).<br/><br/></span><span>Instead of passing the string &quot;1&quot; the Command Topic message&#x27;s payload would be:<br/><br/></span><span>{<br/><br/></span><span>&quot;session-id&quot;:&quot;session-123456789012&quot;,<br/><br/></span><span>&quot;res-topic&quot;:&quot;cmd/hvac/building3/floor2/res&quot;,<br/><br/></span><span>&quot;value&quot;:&quot;1&quot;<br/><br/></span><span>}</span></p></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Topic for telemetry</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>Telemetry is read-only data that is transmitted by a device and aggregated elsewhere.<br/><br/></span><span>A temperature sensor reading might be published by the ESP8266 using this topic<br/><br/></span><span>**dt/hvac/building3/floor2/confroom2/thing1/temperature**<br/><br/></span><span>the temperature units might be published using this topic<br/><br/></span><span>**dt/hvac/building3/floor2/confroom2/thing1/temperature/units**<br/><br/></span><span>A humidity sensor reading might be published by the ESP8266 using this topic<br/><br/></span><span>**dt/hvac/building3/floor2/confroom2/thing1/humidity**<br/><br/></span><span>How often an ESP8266 should publish a value depend on the application. The device could publish an update every few minutes, every few seconds or every time the value changes.</span></p></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Data subscriptions</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>While telemetry messages are being published to the MQTT server client applications can subscribe to individual topics or to multiple topics using wildcards.<br/><br/></span><span>The # wildcard matches multiple topic name levels.<br/><br/></span><span>The + wildcard matches a single topic name level.</span></p></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Humidity sensor readings from 2nd floor of building 3." loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/internetofthings2/screen-shot-2021-03-07-at-3.27.31-pm-1836x938.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Humidity sensor readings from 2nd floor of building 3.</p></div></div></div></div></section><!--$--><!--/$--></main><script src="/_next/static/chunks/webpack-4c42975394ce1617.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[9379,[\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"177\",\"static/chunks/app/layout-b6140098d4dc0e33.js\"],\"default\"]\n3:I[9766,[],\"\"]\n4:I[8924,[],\"\"]\n6:I[4431,[],\"OutletBoundary\"]\n8:I[5278,[],\"AsyncMetadataOutlet\"]\na:I[4431,[],\"ViewportBoundary\"]\nc:I[4431,[],\"MetadataBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[7150,[],\"\"]\n:HL[\"/_next/static/media/949adacb6381283a-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/9dd75fadc5b3df29-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/a7d33c8790143d66.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"RJUMHoOpO5HDs1LInqYrA\",\"p\":\"\",\"c\":[\"\",\"posts\",\"internetOfThings2\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"internetOfThings2\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a7d33c8790143d66.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/web/assets/mobirise-icons2/mobirise2.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/bootstrap/css/bootstrap.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/bootstrap/css/bootstrap-grid.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/bootstrap/css/bootstrap-reboot.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/dropdown/css/style.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/socicon/css/styles.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/theme/css/style.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/mobirise/css/mbr-additional.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/prism.css\"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_2cd903 antialiased\",\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"internetOfThings2\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"promise\":\"$@9\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$d\",null,{\"fallback\":null,\"children\":\"$Le\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:I[2619,[\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"356\",\"static/chunks/356-1fcf197c11312f1f.js\",\"858\",\"static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js\"],\"\"]\n11:I[8889,[\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"356\",\"static/chunks/356-1fcf197c11312f1f.js\",\"858\",\"static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js\"],\"default\"]\n12:T12d3,"])</script><script>self.__next_f.push([1,"\n# Internet of Things (Part 2)\n\n## Node-RED can publish messages to a MQTT broker and subscribe to MQTT topics.\n\n![](/assets/images/internetofthings2/iot-microchip.svg)\n*iot microchip by Philipp Petzka is licensed under CC*\n\n\n## Node-RED\n\nNode-RED can be used to publish messages to an MQTT broker.\n\nNode-RED is able to subscribe to MQTT broker messages.\n\n**$ docker run -it -p 1880:1880 nodered/node-red**\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-04-at-7.46.57-pm-1136x736.png)\n*node-red Docker image*\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.35.48-pm-1836x1045.png)\n*Connecting Node-RED to the MQTT broker*\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.41.33-pm-1836x1051.png)\n*\"mqtt in\" node subscribes to \"outTopic\" messages*\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.42.05-pm-1836x1053.png)\n*\"debug\" node displays the incoming \"outTopic\" messages on debug panel*\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.45.34-pm-1836x1040.png)\n*\"mqtt out\" node publishes \"1\" or \"0\" to the \"inTopic\" and ESP8266 LED turns on or off.*\n\n\n## MQTT topics and payloads\n\nIn the example above \"inTopic\" is a command topic and \"outTopic\" is a topic for telemetry.\n\n\n## Command Topics\n\nIn the example above the ESP8266 microprocessor subscribes to \"inTopic\" messages and when it sees a message with the payload \"1\" the builtin LED is turned on. \n\nIn fact dozens or hundreds of IoT devices could subscribe to \"inTopic\" messages turning on or off together. \n\nBut, what if a developer would like a single ESP8266 device's builtin LED to turn on? What if a developer would like to turn on a fan connected to a single ESP8266 device? What if a developer would like to turn off the fans connected to all ESP8266 devices on given floor of a given building?\n\nWell every device that connects to an MQTT broker has a unique \"thing name\" (and a unique MQTT client id) but how would the publisher of a control message specify that they wanted to turn off the fan connected to the ESP8266 with a given \"thing name\"?\n\n\n## Topic structure\n\nIf a device with thing name \"thing1\" is in conference room 2 on floor 2 of building 3 a developer can arrange for that thing's builtin LED to turn off whenever a message with payload \"0\" is published with this topic:\n\n**cmd/hvac/building3/floor2/confroom2/thing1/builtinled**\n\nA developer can arrange for a fan controlled by thing1 to be turned on whenever a message with payload \"1\" is published with this topic:\n\n**cmd/hvac/building3/floor2/confroom2/thing1/fan**\n\nA developer can arrange for fans controlled by all things on floor 2 to be turned off when a message with payload \"0\" is published with this topic:\n\n**cmd/hvac/building3/floor2/fan**\n\nSample ESP8266 code is shown below.\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-07-at-11.21.47-am-1836x1106.png)\n*publishing to \"cmd/hvac/building3/floor2/confroom2/thing1/builtinled\"*\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-07-at-11.35.42-am-1836x1108.png)\n*subscribing to \"cmd/hvac/#'*\n\n\n## Response\n\nIf the publisher of a Command Topic message wants to receive responses they might provide a JSON payload that includes a \"session-id\" and a \"res-topic\". The session-id would be passed to the ESP8266 device so that it can differentiate between commands that are repeated or re-sent over time. The res-topic would be used as the response message's topic (it is better not to hardcode the response message's topic).\n\nInstead of passing the string \"1\" the Command Topic message's payload would be:\n\n{\n\"session-id\":\"session-123456789012\",\n\"res-topic\":\"cmd/hvac/building3/floor2/res\",\n\"value\":\"1\"\n}\n\n\n## Topic for telemetry\n\nTelemetry is read-only data that is transmitted by a device and aggregated elsewhere.\n\nA temperature sensor reading might be published by the ESP8266 using this topic \n\n**dt/hvac/building3/floor2/confroom2/thing1/temperature**\n\nthe temperature units might be published using this topic\n\n**dt/hvac/building3/floor2/confroom2/thing1/temperature/units**\n\nA humidity sensor reading might be published by the ESP8266 using this topic\n\n**dt/hvac/building3/floor2/confroom2/thing1/humidity**\n\nHow often an ESP8266 should publish a value depend on the application. The device could publish an update every few minutes, every few seconds or every time the value changes.\n\n\n## Data subscriptions\n\nWhile telemetry messages are being published to the MQTT server client applications can subscribe to individual topics or to multiple topics using wildcards.\n\nThe # wildcard matches multiple topic name levels. \n\nThe + wildcard matches a single topic name level.\n\n![](/assets/images/internetofthings2/screen-shot-2021-03-07-at-3.27.31-pm-1836x938.png)\n*Humidity sensor readings from 2nd floor of building 3.*\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"section\",null,{\"className\":\"content4 cid-uBU3VQlp0E\",\"id\":\"content4-cru\",\"children\":[\"$\",\"div\",null,{\"className\":\"container\",\"children\":[\"$\",\"div\",null,{\"className\":\"row justify-content-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"title col-md-12 col-lg-10\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"mbr-section-title mbr-fonts-style align-center mb-4 display-2\",\"children\":[\"$\",\"strong\",null,{\"children\":\"Internet of Things (Part 2)\"}]}],[\"$\",\"h4\",null,{\"className\":\"mbr-section-subtitle align-center mbr-fonts-style mb-4 display-5\",\"children\":\"A comprehensive guide covering internet of things2\"}]]}]}]}]}],[\"$\",\"section\",null,{\"className\":\"content1 cid-content\",\"id\":\"content1-breadcrumb\",\"children\":[\"$\",\"div\",null,{\"className\":\"container\",\"children\":[\"$\",\"div\",null,{\"className\":\"row justify-content-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"col-md-12 col-lg-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"mb-4\",\"children\":[\"$\",\"$L10\",null,{\"href\":\"/posts\",\"className\":\"link text-primary display-7\",\"children\":\"← Back to Posts\"}]}]}]}]}]}],[\"$\",\"$L11\",null,{\"markdownContent\":\"$12\"}]]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"13:I[622,[],\"IconMark\"]\n"])</script><script>self.__next_f.push([1,"9:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Neil Haddley - Developer \u0026 Technical Consultant\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"I help organizations to connect with clients, comply with regulations, and automate workflows.\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Neil Haddley\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"developer, consultant, Azure, Angular, Business Central, automation\"}],[\"$\",\"meta\",\"4\",{\"name\":\"creator\",\"content\":\"Neil Haddley\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Neil Haddley - Developer \u0026 Technical Consultant\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"I help organizations to connect with clients, comply with regulations, and automate workflows.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"https://haddley.github.io/\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:site_name\",\"content\":\"Neil Haddley\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:title\",\"content\":\"Neil Haddley - Developer \u0026 Technical Consultant\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:description\",\"content\":\"I help organizations to connect with clients, comply with regulations, and automate workflows.\"}],[\"$\",\"link\",\"14\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"$L13\",\"15\",{}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"e:\"$9:metadata\"\n"])</script></body></html>