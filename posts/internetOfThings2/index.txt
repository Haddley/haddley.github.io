1:"$Sreact.fragment"
2:I[9379,["619","static/chunks/619-ba102abea3e3d0e4.js","177","static/chunks/app/layout-b6140098d4dc0e33.js"],"default"]
3:I[9766,[],""]
4:I[8924,[],""]
6:I[4431,[],"OutletBoundary"]
8:I[5278,[],"AsyncMetadataOutlet"]
a:I[4431,[],"ViewportBoundary"]
c:I[4431,[],"MetadataBoundary"]
d:"$Sreact.suspense"
f:I[7150,[],""]
:HL["/_next/static/media/949adacb6381283a-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/media/9dd75fadc5b3df29-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/a7d33c8790143d66.css","style"]
0:{"P":null,"b":"RJUMHoOpO5HDs1LInqYrA","p":"","c":["","posts","internetOfThings2",""],"i":false,"f":[[["",{"children":["posts",{"children":[["slug","internetOfThings2","d"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/a7d33c8790143d66.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":[["$","head",null,{"children":[["$","link",null,{"rel":"stylesheet","href":"/assets/web/assets/mobirise-icons2/mobirise2.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/bootstrap/css/bootstrap.min.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/bootstrap/css/bootstrap-grid.min.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/bootstrap/css/bootstrap-reboot.min.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/dropdown/css/style.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/socicon/css/styles.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/theme/css/style.css"}],["$","link",null,{"rel":"stylesheet","href":"/assets/mobirise/css/mbr-additional.css"}],["$","link",null,{"rel":"stylesheet","href":"/prism.css"}]]}],["$","body",null,{"className":"__className_2cd903 antialiased","children":[["$","$L2",null,{}],["$","main",null,{"children":["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]]}]]}]]}],{"children":["posts",["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["slug","internetOfThings2","d"],["$","$1","c",{"children":[null,["$","$L3",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L4",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L5",null,["$","$L6",null,{"children":["$L7",["$","$L8",null,{"promise":"$@9"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,[["$","$La",null,{"children":"$Lb"}],["$","meta",null,{"name":"next-size-adjust","content":""}]],["$","$Lc",null,{"children":["$","div",null,{"hidden":true,"children":["$","$d",null,{"fallback":null,"children":"$Le"}]}]}]]}],false]],"m":"$undefined","G":["$f",[]],"s":false,"S":true}
10:I[2619,["619","static/chunks/619-ba102abea3e3d0e4.js","356","static/chunks/356-1fcf197c11312f1f.js","858","static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js"],""]
11:I[8889,["619","static/chunks/619-ba102abea3e3d0e4.js","356","static/chunks/356-1fcf197c11312f1f.js","858","static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js"],"default"]
12:T12d3,
# Internet of Things (Part 2)

## Node-RED can publish messages to a MQTT broker and subscribe to MQTT topics.

![](/assets/images/internetofthings2/iot-microchip.svg)
*iot microchip by Philipp Petzka is licensed under CC*


## Node-RED

Node-RED can be used to publish messages to an MQTT broker.

Node-RED is able to subscribe to MQTT broker messages.

**$ docker run -it -p 1880:1880 nodered/node-red**

![](/assets/images/internetofthings2/screen-shot-2021-03-04-at-7.46.57-pm-1136x736.png)
*node-red Docker image*

![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.35.48-pm-1836x1045.png)
*Connecting Node-RED to the MQTT broker*

![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.41.33-pm-1836x1051.png)
*"mqtt in" node subscribes to "outTopic" messages*

![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.42.05-pm-1836x1053.png)
*"debug" node displays the incoming "outTopic" messages on debug panel*

![](/assets/images/internetofthings2/screen-shot-2021-03-06-at-11.45.34-pm-1836x1040.png)
*"mqtt out" node publishes "1" or "0" to the "inTopic" and ESP8266 LED turns on or off.*


## MQTT topics and payloads

In the example above "inTopic" is a command topic and "outTopic" is a topic for telemetry.


## Command Topics

In the example above the ESP8266 microprocessor subscribes to "inTopic" messages and when it sees a message with the payload "1" the builtin LED is turned on. 

In fact dozens or hundreds of IoT devices could subscribe to "inTopic" messages turning on or off together. 

But, what if a developer would like a single ESP8266 device's builtin LED to turn on? What if a developer would like to turn on a fan connected to a single ESP8266 device? What if a developer would like to turn off the fans connected to all ESP8266 devices on given floor of a given building?

Well every device that connects to an MQTT broker has a unique "thing name" (and a unique MQTT client id) but how would the publisher of a control message specify that they wanted to turn off the fan connected to the ESP8266 with a given "thing name"?


## Topic structure

If a device with thing name "thing1" is in conference room 2 on floor 2 of building 3 a developer can arrange for that thing's builtin LED to turn off whenever a message with payload "0" is published with this topic:

**cmd/hvac/building3/floor2/confroom2/thing1/builtinled**

A developer can arrange for a fan controlled by thing1 to be turned on whenever a message with payload "1" is published with this topic:

**cmd/hvac/building3/floor2/confroom2/thing1/fan**

A developer can arrange for fans controlled by all things on floor 2 to be turned off when a message with payload "0" is published with this topic:

**cmd/hvac/building3/floor2/fan**

Sample ESP8266 code is shown below.

![](/assets/images/internetofthings2/screen-shot-2021-03-07-at-11.21.47-am-1836x1106.png)
*publishing to "cmd/hvac/building3/floor2/confroom2/thing1/builtinled"*

![](/assets/images/internetofthings2/screen-shot-2021-03-07-at-11.35.42-am-1836x1108.png)
*subscribing to "cmd/hvac/#'*


## Response

If the publisher of a Command Topic message wants to receive responses they might provide a JSON payload that includes a "session-id" and a "res-topic". The session-id would be passed to the ESP8266 device so that it can differentiate between commands that are repeated or re-sent over time. The res-topic would be used as the response message's topic (it is better not to hardcode the response message's topic).

Instead of passing the string "1" the Command Topic message's payload would be:

{
"session-id":"session-123456789012",
"res-topic":"cmd/hvac/building3/floor2/res",
"value":"1"
}


## Topic for telemetry

Telemetry is read-only data that is transmitted by a device and aggregated elsewhere.

A temperature sensor reading might be published by the ESP8266 using this topic 

**dt/hvac/building3/floor2/confroom2/thing1/temperature**

the temperature units might be published using this topic

**dt/hvac/building3/floor2/confroom2/thing1/temperature/units**

A humidity sensor reading might be published by the ESP8266 using this topic

**dt/hvac/building3/floor2/confroom2/thing1/humidity**

How often an ESP8266 should publish a value depend on the application. The device could publish an update every few minutes, every few seconds or every time the value changes.


## Data subscriptions

While telemetry messages are being published to the MQTT server client applications can subscribe to individual topics or to multiple topics using wildcards.

The # wildcard matches multiple topic name levels. 

The + wildcard matches a single topic name level.

![](/assets/images/internetofthings2/screen-shot-2021-03-07-at-3.27.31-pm-1836x938.png)
*Humidity sensor readings from 2nd floor of building 3.*
5:[["$","section",null,{"className":"content4 cid-uBU3VQlp0E","id":"content4-cru","children":["$","div",null,{"className":"container","children":["$","div",null,{"className":"row justify-content-center","children":["$","div",null,{"className":"title col-md-12 col-lg-10","children":[["$","h3",null,{"className":"mbr-section-title mbr-fonts-style align-center mb-4 display-2","children":["$","strong",null,{"children":"Internet of Things (Part 2)"}]}],["$","h4",null,{"className":"mbr-section-subtitle align-center mbr-fonts-style mb-4 display-5","children":"A comprehensive guide covering internet of things2"}]]}]}]}]}],["$","section",null,{"className":"content1 cid-content","id":"content1-breadcrumb","children":["$","div",null,{"className":"container","children":["$","div",null,{"className":"row justify-content-center","children":["$","div",null,{"className":"col-md-12 col-lg-10","children":["$","div",null,{"className":"mb-4","children":["$","$L10",null,{"href":"/posts","className":"link text-primary display-7","children":"‚Üê Back to Posts"}]}]}]}]}]}],["$","$L11",null,{"markdownContent":"$12"}]]
b:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
7:null
13:I[622,[],"IconMark"]
9:{"metadata":[["$","title","0",{"children":"Neil Haddley - Developer & Technical Consultant"}],["$","meta","1",{"name":"description","content":"I help organizations to connect with clients, comply with regulations, and automate workflows."}],["$","meta","2",{"name":"author","content":"Neil Haddley"}],["$","meta","3",{"name":"keywords","content":"developer, consultant, Azure, Angular, Business Central, automation"}],["$","meta","4",{"name":"creator","content":"Neil Haddley"}],["$","meta","5",{"property":"og:title","content":"Neil Haddley - Developer & Technical Consultant"}],["$","meta","6",{"property":"og:description","content":"I help organizations to connect with clients, comply with regulations, and automate workflows."}],["$","meta","7",{"property":"og:url","content":"https://haddley.github.io/"}],["$","meta","8",{"property":"og:site_name","content":"Neil Haddley"}],["$","meta","9",{"property":"og:locale","content":"en_US"}],["$","meta","10",{"property":"og:type","content":"website"}],["$","meta","11",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","12",{"name":"twitter:title","content":"Neil Haddley - Developer & Technical Consultant"}],["$","meta","13",{"name":"twitter:description","content":"I help organizations to connect with clients, comply with regulations, and automate workflows."}],["$","link","14",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}],["$","$L13","15",{}]],"error":null,"digest":"$undefined"}
e:"$9:metadata"
