<!DOCTYPE html><!--RJUMHoOpO5HDs1LInqYrA--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/949adacb6381283a-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/9dd75fadc5b3df29-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/a7d33c8790143d66.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-4c42975394ce1617.js"/><script src="/_next/static/chunks/4bd1b696-c023c6e3521b1417.js" async=""></script><script src="/_next/static/chunks/255-fe5c522e6d28d73f.js" async=""></script><script src="/_next/static/chunks/main-app-f50e9b07a96b5107.js" async=""></script><script src="/_next/static/chunks/619-ba102abea3e3d0e4.js" async=""></script><script src="/_next/static/chunks/app/layout-b6140098d4dc0e33.js" async=""></script><script src="/_next/static/chunks/356-1fcf197c11312f1f.js" async=""></script><script src="/_next/static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js" async=""></script><meta name="next-size-adjust" content=""/><title>Neil Haddley - Developer &amp; Technical Consultant</title><meta name="description" content="I help organizations to connect with clients, comply with regulations, and automate workflows."/><meta name="author" content="Neil Haddley"/><meta name="keywords" content="developer, consultant, Azure, Angular, Business Central, automation"/><meta name="creator" content="Neil Haddley"/><meta property="og:title" content="Neil Haddley - Developer &amp; Technical Consultant"/><meta property="og:description" content="I help organizations to connect with clients, comply with regulations, and automate workflows."/><meta property="og:url" content="https://haddley.github.io/"/><meta property="og:site_name" content="Neil Haddley"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Neil Haddley - Developer &amp; Technical Consultant"/><meta name="twitter:description" content="I help organizations to connect with clients, comply with regulations, and automate workflows."/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><link rel="stylesheet" href="/assets/web/assets/mobirise-icons2/mobirise2.css"/><link rel="stylesheet" href="/assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css"/><link rel="stylesheet" href="/assets/bootstrap/css/bootstrap.min.css"/><link rel="stylesheet" href="/assets/bootstrap/css/bootstrap-grid.min.css"/><link rel="stylesheet" href="/assets/bootstrap/css/bootstrap-reboot.min.css"/><link rel="stylesheet" href="/assets/dropdown/css/style.css"/><link rel="stylesheet" href="/assets/socicon/css/styles.css"/><link rel="stylesheet" href="/assets/theme/css/style.css"/><link rel="stylesheet" href="/assets/mobirise/css/mbr-additional.css"/><link rel="stylesheet" href="/prism.css"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_2cd903 antialiased"><div hidden=""><!--$--><!--/$--></div><section class="menu menu3 cid-uBU3VPzqgj" id="menu3-crt"><nav class="navbar navbar-dropdown navbar-fixed-top navbar-expand-lg"><div class="container"><div class="navbar-brand"><span class="navbar-caption-wrap"><a class="navbar-caption text-black text-primary display-7" href="/">Neil Haddley</a></span></div><button class="navbar-toggler" type="button" aria-expanded="false" aria-label="Toggle navigation"><div class="hamburger"><span></span><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse " id="navbarSupportedContent"><ul class="navbar-nav nav-dropdown nav-right"><li class="nav-item"><a class="nav-link link text-black text-primary display-4" href="/posts/">Blog Posts</a></li></ul><div class="icons-menu"><a class="iconfont-wrapper" href="https://www.linkedin.com/in/neil-haddley/" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont socicon-linkedin socicon"></span></a><a class="iconfont-wrapper" href="https://github.com/haddley" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont mbrib-github"></span></a><a class="iconfont-wrapper" href="https://www.npmjs.com/~haddley" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont socicon-npm socicon"></span></a><a class="iconfont-wrapper" href="https://hub.docker.com/u/haddley" target="_blank" rel="noopener noreferrer"><span class="p-2 mbr-iconfont mobi-mbri-delivery mobi-mbri"></span></a></div></div></div></nav></section><main><section class="content4 cid-uBU3VQlp0E" id="content4-cru"><div class="container"><div class="row justify-content-center"><div class="title col-md-12 col-lg-10"><h3 class="mbr-section-title mbr-fonts-style align-center mb-4 display-2"><strong>Azure Active Directory (Part 2)</strong></h3><h4 class="mbr-section-subtitle align-center mbr-fonts-style mb-4 display-5">A comprehensive guide covering azure-active-directory2</h4></div></div></div></section><section class="content1 cid-content" id="content1-breadcrumb"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><div class="mb-4"><a class="link text-primary display-7" href="/posts/">← Back to Posts</a></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Microsoft Azure Active Directory Authentication.</h4></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Microsoft Azure Logo by Microsoft Corporation is Public Domain" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/microsoft-azure-logo.svg"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Microsoft Azure Logo by Microsoft Corporation is Public Domain</p></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Single-page application with login</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>Quickstart projects make it easier to build applications that connect to Azure Active Directory, Microsoft Graph and other Azure resources.<br/><br/></span><span>Quickstart projects allow developers to create Web applications, Single page applications (SPAs), Mobile and desktop applications and Daemon applications.<br/><br/></span><span>Here we create a &quot;Haddley React Single Page App&quot; that supports Azure Active Directory login</span></p></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="topology_callgraph by Doğan Erişen is licensed under MIT License" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/topology-callgraph-700x403.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">topology_callgraph by Doğan Erişen is licensed under MIT License</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Name is Haddley React Single Page App" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.42.46-am-1836x1481.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Name is Haddley React Single Page App</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Select &quot;Single-page application (SPA)&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-10.27.44-am-1376x1060.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Select &quot;Single-page application (SPA)&quot;</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Select &quot;React (preview)&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.43.42-am-1638x702.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Select &quot;React (preview)&quot;</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Allow the Quickstart to update the Redirect URI to &quot;http://localhost:3000/&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.44.44-am-1836x714.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Allow the Quickstart to update the Redirect URI to &quot;http://localhost:3000/&quot;</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Download the fully configured code sample" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.45.15-am-1836x952.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Download the fully configured code sample</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Open project using Visual Studio Code" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.45.53-am-1836x499.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Open project using Visual Studio Code</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Open terminal and run &quot;npm install&quot; and then &quot;npm start&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.47.49-am-1836x1372.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Open terminal and run &quot;npm install&quot; and then &quot;npm start&quot;</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Select either &quot;Sign in using Popup&quot; or &quot;Sign in using Redirect&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.49.20-am-1836x948.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Select either &quot;Sign in using Popup&quot; or &quot;Sign in using Redirect&quot;</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Pick an account" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.49.49-am-962x498.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Pick an account</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Enter the password" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.49.59-am-964x660.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Enter the password</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Accept" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.50.15-am-966x1310.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Accept</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="After pressing &quot;Request Profile Information&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.50.35-am-1836x947.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">After pressing &quot;Request Profile Information&quot;</p></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Vanilla JavaScript single-page application (SPA) using MSAL.js to authorize users for calling a protected web API on Azure AD</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>[https://github.com/Azure-Samples/ms-identity-javascript-tutorial/tree/main/3-Authorization-II/1-call-api](https://github.com/Azure-Samples/ms-identity-javascript-tutorial/tree/main/3-Authorization-II/1-call-api)</span></p></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="topology_callapi by Doğan Erişen is licensed under MIT License" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/topology-callapi-631x362.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">topology_callapi by Doğan Erişen is licensed under MIT License</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt=".\Configure.ps1" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/image-859x481.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">.\Configure.ps1</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="update Manifest &quot;accessTokenAcceptedVersion&quot;" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.31.02-pm-1836x989.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">update Manifest &quot;accessTokenAcceptedVersion&quot;</p></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Configure and run the Client (SPA) and Service (API) apps</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>**Configure the service app to use your app registration**<br/><br/></span><span>Open the project in your IDE (like Visual Studio or Visual Studio Code) to configure the code.<br/><br/></span><span>In the steps below, &quot;ClientID&quot; is the same as &quot;Application ID&quot; or &quot;AppId&quot;.<br/><br/></span><span>Open the config.js file.<br/><br/></span><span>Find the key clientID and replace the existing value with the application ID (clientId) of the ms-identity-javascript-tutorial-c3s1-api application copied from the Azure portal.<br/><br/></span><span>Find the key tenantID and replace the existing value with your Azure AD tenant ID.<br/><br/></span><span>Find the key audience and replace the existing value with the application ID (clientId) of the ms-identity-javascript-tutorial-c3s1-api application copied from the Azure portal.<br/><br/></span><span>Register the client app<br/><br/></span><span>**Configure the client app to use your app registration**<br/><br/></span><span>Open the project in your IDE (like Visual Studio or Visual Studio Code) to configure the code.<br/><br/></span><span>In the steps below, &quot;ClientID&quot; is the same as &quot;Application ID&quot; or &quot;AppId&quot;.<br/><br/></span><span>Open the App\authConfig.js file. Then:<br/><br/></span><span>Find the key Enter_the_Application_Id_Here and replace the existing value with the application ID (clientId) of the ms-identity-javascript-c3s1-spa application copied from the Azure portal.<br/><br/></span><span>Find the key Enter_the_Cloud_Instance_Id_Here/Enter_the_Tenant_Info_Here and replace the existing value with https://login.microsoftonline.com/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX (where XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX is the Directory (tenant) ID - same value for all app registrations created in that Azure tenant).<br/><br/></span><span>Find the key Enter_the_Redirect_Uri_Here and replace the existing value with the base address of the ms-identity-javascript-tutorial-c3s1-spa application (by default http://localhost:3000).<br/><br/></span><span>After you configured your web API, open the App\apiConfig.js file. Then:<br/><br/></span><span>Find the key Enter_the_Web_Api_Uri_Here and replace the existing value with the coordinates of your web API (by default http://localhost:5000/api).<br/><br/></span><span>Find the key Enter_the_Web_Api_Scope_Here and replace the existing value with the scopes for your web API, like api://e767d418-b80b-4568-9754-557f40697fc5/access_as_user. You can copy this from the Expose an API blade of the web APIs registration.</span></p></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Click Sign-in" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.53.33-pm-1644x1184.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Click Sign-in</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Enter Azure/Office 365 credentials to login to" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.53.56-pm-964x1310.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Enter Azure/Office 365 credentials to login to</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Press Call API to ask Single Page Application to call protected API" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.54.17-pm-1640x1180.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Press Call API to ask Single Page Application to call protected API</p></div></div></div></div></section><section class="image3 cid-image3" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-12 col-lg-10"><div class="image-wrapper"><img alt="Result returned from protect API" loading="lazy" width="800" height="600" decoding="async" data-nimg="1" class="img-fluid" style="color:transparent;width:100%;height:auto" src="/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.54.36-pm-1640x1184.png"/><p class="mbr-description mbr-fonts-style mt-2 align-center display-4">Result returned from protect API</p></div></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><h4 class="mbr-section-subtitle mbr-fonts-style mb-4 display-5">Discussion</h4></div></div></div></section><section class="content5 cid-content5" data-bs-version="5.1"><div class="container"><div class="row justify-content-center"><div class="col-md-12 col-lg-10"><p class="mbr-text mbr-fonts-style display-7"><span>SPA is a single page application based on an html file and JavaScript (not React, Angular or Vue). As authPopup.js (or authRedirect.js) is loaded myMSALObj is set to a new msal.PublicClientApplication instance using msalConfig. further down in the same file &quot;selectAccount();&quot; is called. selectAccount calls the getAllAccounts method on the msal.PublicClientApplication instance. If at least one account is returned the welcomeUser function is called passing the username from the first account.<br/><br/></span><span>welcomeUser is defined in ui.js. welcomeUser uses document.getElementById and css classes to update the html page (showing if a user is logged in).<br/><br/></span><span>If the html signIn button is pressed the signIn function in authPopup.js (or authRedirect.js) is run. This calls the loginPopup (or loginRedirect) method on the msal.PublicClientApplication instance passing loginRequest (an object with a scopes property ... {scopes: [&quot;openid&quot;, &quot;api://ae580c57-2645-404d-a870-2a390db782ec/access_as_user&quot;]} ). The handleResponse function is called if the user login succeeds. The handleResponse function sets a username variable and calls the welcomeUser function again (passing the value of that username variable).<br/><br/></span><span>If the html callApiButton button is pressed the passTokenToApi function is executed. The passTokenToApi function calls getTokenPopup (or getTokenRedirect) which uses myMSALObj.acquireTokenSilent and (possibly) the myMSALObj.acquireTokenPopup (or myMSALObj.acquireTokenRedirect) methods (here the constant tokenRequest is used { scopes: [&quot;Mail.Read&quot;] } although we do not go on to read mail...).<br/><br/></span><span>Once the access_token has been acquired function callApi is called passing apiConfig.uri (&quot;http://localhost:5000/api&quot;) and the response.accessToken. callApi appends an Authorization header with value accessToken and uses fetch to call the API. The response from the API call should include the logged in user&#x27;s **name**.<br/><br/></span><span>API is a Node express app. The code starts by defining const app=express(). &quot;morgan&quot; (for debugging) and &quot;passport&quot; are added to the express instance. bearerStrategy is added to the passport reference. CORS is enabled using permissive headers.<br/><br/></span><span>Then the &quot;/api&quot; endpoint is exposed. The /api handler is only run if passport.authenticated (see the response received from Azure Active Directory requesting &quot;access_as_user&quot; permissions). req.authInfo provides authentication information. In the sample information from the req.authInfo property is returned as the result of the API call (including the logged in user&#x27;s **name**).</span></p></div></div></div></section><!--$--><!--/$--></main><script src="/_next/static/chunks/webpack-4c42975394ce1617.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[9379,[\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"177\",\"static/chunks/app/layout-b6140098d4dc0e33.js\"],\"default\"]\n3:I[9766,[],\"\"]\n4:I[8924,[],\"\"]\n6:I[4431,[],\"OutletBoundary\"]\n8:I[5278,[],\"AsyncMetadataOutlet\"]\na:I[4431,[],\"ViewportBoundary\"]\nc:I[4431,[],\"MetadataBoundary\"]\nd:\"$Sreact.suspense\"\nf:I[7150,[],\"\"]\n:HL[\"/_next/static/media/949adacb6381283a-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/9dd75fadc5b3df29-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/a7d33c8790143d66.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"RJUMHoOpO5HDs1LInqYrA\",\"p\":\"\",\"c\":[\"\",\"posts\",\"azure-active-directory2\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"posts\",{\"children\":[[\"slug\",\"azure-active-directory2\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/a7d33c8790143d66.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/web/assets/mobirise-icons2/mobirise2.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/web/assets/mobirise-icons-bold/mobirise-icons-bold.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/bootstrap/css/bootstrap.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/bootstrap/css/bootstrap-grid.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/bootstrap/css/bootstrap-reboot.min.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/dropdown/css/style.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/socicon/css/styles.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/theme/css/style.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/assets/mobirise/css/mbr-additional.css\"}],[\"$\",\"link\",null,{\"rel\":\"stylesheet\",\"href\":\"/prism.css\"}]]}],[\"$\",\"body\",null,{\"className\":\"__className_2cd903 antialiased\",\"children\":[[\"$\",\"$L2\",null,{}],[\"$\",\"main\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}]]}]]}],{\"children\":[\"posts\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"slug\",\"azure-active-directory2\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L5\",null,[\"$\",\"$L6\",null,{\"children\":[\"$L7\",[\"$\",\"$L8\",null,{\"promise\":\"$@9\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$La\",null,{\"children\":\"$Lb\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$Lc\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$d\",null,{\"fallback\":null,\"children\":\"$Le\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$f\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"10:I[2619,[\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"356\",\"static/chunks/356-1fcf197c11312f1f.js\",\"858\",\"static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js\"],\"\"]\n11:I[8889,[\"619\",\"static/chunks/619-ba102abea3e3d0e4.js\",\"356\",\"static/chunks/356-1fcf197c11312f1f.js\",\"858\",\"static/chunks/app/posts/%5Bslug%5D/page-313a7831d907d705.js\"],\"default\"]\n12:T2121,"])</script><script>self.__next_f.push([1,"\n# Azure Active Directory (Part 2)\n\n## Microsoft Azure Active Directory Authentication.\n\n![](/assets/images/azure-active-directory2/microsoft-azure-logo.svg)\n*Microsoft Azure Logo by Microsoft Corporation is Public Domain*\n\n\n## Single-page application with login\n\nQuickstart projects make it easier to build applications that connect to Azure Active Directory, Microsoft Graph and other Azure resources.\n\nQuickstart projects allow developers to create Web applications, Single page applications (SPAs), Mobile and desktop applications and Daemon applications. \n\nHere we create a \"Haddley React Single Page App\" that supports Azure Active Directory login\n\n![](/assets/images/azure-active-directory2/topology-callgraph-700x403.png)\n*topology_callgraph by Doğan Erişen is licensed under MIT License*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.42.46-am-1836x1481.png)\n*Name is Haddley React Single Page App*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-10.27.44-am-1376x1060.png)\n*Select \"Single-page application (SPA)\"*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.43.42-am-1638x702.png)\n*Select \"React (preview)\"*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.44.44-am-1836x714.png)\n*Allow the Quickstart to update the Redirect URI to \"http://localhost:3000/\"*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.45.15-am-1836x952.png)\n*Download the fully configured code sample*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.45.53-am-1836x499.png)\n*Open project using Visual Studio Code*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.47.49-am-1836x1372.png)\n*Open terminal and run \"npm install\" and then \"npm start\"*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.49.20-am-1836x948.png)\n*Select either \"Sign in using Popup\" or \"Sign in using Redirect\"*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.49.49-am-962x498.png)\n*Pick an account*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.49.59-am-964x660.png)\n*Enter the password*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.50.15-am-966x1310.png)\n*Accept*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-9.50.35-am-1836x947.png)\n*After pressing \"Request Profile Information\"*\n\n\n## Vanilla JavaScript single-page application (SPA) using MSAL.js to authorize users for calling a protected web API on Azure AD\n\n[https://github.com/Azure-Samples/ms-identity-javascript-tutorial/tree/main/3-Authorization-II/1-call-api](https://github.com/Azure-Samples/ms-identity-javascript-tutorial/tree/main/3-Authorization-II/1-call-api)\n\n![](/assets/images/azure-active-directory2/topology-callapi-631x362.png)\n*topology_callapi by Doğan Erişen is licensed under MIT License*\n\n![](/assets/images/azure-active-directory2/image-859x481.png)\n*.\\Configure.ps1*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.31.02-pm-1836x989.png)\n*update Manifest \"accessTokenAcceptedVersion\"*\n\n\n## Configure and run the Client (SPA) and Service (API) apps\n\n**Configure the service app to use your app registration**\n\nOpen the project in your IDE (like Visual Studio or Visual Studio Code) to configure the code.\n\nIn the steps below, \"ClientID\" is the same as \"Application ID\" or \"AppId\".\nOpen the config.js file.\nFind the key clientID and replace the existing value with the application ID (clientId) of the ms-identity-javascript-tutorial-c3s1-api application copied from the Azure portal.\nFind the key tenantID and replace the existing value with your Azure AD tenant ID.\nFind the key audience and replace the existing value with the application ID (clientId) of the ms-identity-javascript-tutorial-c3s1-api application copied from the Azure portal.\nRegister the client app\n\n**Configure the client app to use your app registration**\n\nOpen the project in your IDE (like Visual Studio or Visual Studio Code) to configure the code.\n\nIn the steps below, \"ClientID\" is the same as \"Application ID\" or \"AppId\".\nOpen the App\\authConfig.js file. Then:\n\nFind the key Enter_the_Application_Id_Here and replace the existing value with the application ID (clientId) of the ms-identity-javascript-c3s1-spa application copied from the Azure portal.\nFind the key Enter_the_Cloud_Instance_Id_Here/Enter_the_Tenant_Info_Here and replace the existing value with https://login.microsoftonline.com/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX (where XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX is the Directory (tenant) ID - same value for all app registrations created in that Azure tenant).\n\nFind the key Enter_the_Redirect_Uri_Here and replace the existing value with the base address of the ms-identity-javascript-tutorial-c3s1-spa application (by default http://localhost:3000).\nAfter you configured your web API, open the App\\apiConfig.js file. Then:\n\nFind the key Enter_the_Web_Api_Uri_Here and replace the existing value with the coordinates of your web API (by default http://localhost:5000/api).\n\nFind the key Enter_the_Web_Api_Scope_Here and replace the existing value with the scopes for your web API, like api://e767d418-b80b-4568-9754-557f40697fc5/access_as_user. You can copy this from the Expose an API blade of the web APIs registration.\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.53.33-pm-1644x1184.png)\n*Click Sign-in*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.53.56-pm-964x1310.png)\n*Enter Azure/Office 365 credentials to login to*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.54.17-pm-1640x1180.png)\n*Press Call API to ask Single Page Application to call protected API*\n\n![](/assets/images/azure-active-directory2/screen-shot-2021-04-17-at-4.54.36-pm-1640x1184.png)\n*Result returned from protect API*\n\n\n## Discussion\n\nSPA is a single page application based on an html file and JavaScript (not React, Angular or Vue). As authPopup.js (or authRedirect.js) is loaded myMSALObj is set to a new msal.PublicClientApplication instance using msalConfig. further down in the same file \"selectAccount();\" is called. selectAccount calls the getAllAccounts method on the msal.PublicClientApplication instance. If at least one account is returned the welcomeUser function is called passing the username from the first account.\n\nwelcomeUser is defined in ui.js. welcomeUser uses document.getElementById and css classes to update the html page (showing if a user is logged in).\n\nIf the html signIn button is pressed the signIn function in authPopup.js (or authRedirect.js) is run. This calls the loginPopup (or loginRedirect) method on the msal.PublicClientApplication instance passing loginRequest (an object with a scopes property ... {scopes: [\"openid\", \"api://ae580c57-2645-404d-a870-2a390db782ec/access_as_user\"]} ). The handleResponse function is called if the user login succeeds. The handleResponse function sets a username variable and calls the welcomeUser function again (passing the value of that username variable).\n\nIf the html callApiButton button is pressed the passTokenToApi function is executed. The passTokenToApi function calls getTokenPopup (or getTokenRedirect) which uses myMSALObj.acquireTokenSilent and (possibly) the myMSALObj.acquireTokenPopup (or myMSALObj.acquireTokenRedirect) methods (here the constant tokenRequest is used { scopes: [\"Mail.Read\"] } although we do not go on to read mail...). \n\nOnce the access_token has been acquired function callApi is called passing apiConfig.uri (\"http://localhost:5000/api\") and the response.accessToken. callApi appends an Authorization header with value accessToken and uses fetch to call the API. The response from the API call should include the logged in user's **name**.\n\nAPI is a Node express app. The code starts by defining const app=express(). \"morgan\" (for debugging) and \"passport\" are added to the express instance. bearerStrategy is added to the passport reference. CORS is enabled using permissive headers.\n\nThen the \"/api\" endpoint is exposed. The /api handler is only run if passport.authenticated (see the response received from Azure Active Directory requesting \"access_as_user\" permissions). req.authInfo provides authentication information. In the sample information from the req.authInfo property is returned as the result of the API call (including the logged in user's **name**).\n"])</script><script>self.__next_f.push([1,"5:[[\"$\",\"section\",null,{\"className\":\"content4 cid-uBU3VQlp0E\",\"id\":\"content4-cru\",\"children\":[\"$\",\"div\",null,{\"className\":\"container\",\"children\":[\"$\",\"div\",null,{\"className\":\"row justify-content-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"title col-md-12 col-lg-10\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"mbr-section-title mbr-fonts-style align-center mb-4 display-2\",\"children\":[\"$\",\"strong\",null,{\"children\":\"Azure Active Directory (Part 2)\"}]}],[\"$\",\"h4\",null,{\"className\":\"mbr-section-subtitle align-center mbr-fonts-style mb-4 display-5\",\"children\":\"A comprehensive guide covering azure-active-directory2\"}]]}]}]}]}],[\"$\",\"section\",null,{\"className\":\"content1 cid-content\",\"id\":\"content1-breadcrumb\",\"children\":[\"$\",\"div\",null,{\"className\":\"container\",\"children\":[\"$\",\"div\",null,{\"className\":\"row justify-content-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"col-md-12 col-lg-10\",\"children\":[\"$\",\"div\",null,{\"className\":\"mb-4\",\"children\":[\"$\",\"$L10\",null,{\"href\":\"/posts\",\"className\":\"link text-primary display-7\",\"children\":\"← Back to Posts\"}]}]}]}]}]}],[\"$\",\"$L11\",null,{\"markdownContent\":\"$12\"}]]\n"])</script><script>self.__next_f.push([1,"b:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n7:null\n"])</script><script>self.__next_f.push([1,"13:I[622,[],\"IconMark\"]\n"])</script><script>self.__next_f.push([1,"9:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Neil Haddley - Developer \u0026 Technical Consultant\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"I help organizations to connect with clients, comply with regulations, and automate workflows.\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Neil Haddley\"}],[\"$\",\"meta\",\"3\",{\"name\":\"keywords\",\"content\":\"developer, consultant, Azure, Angular, Business Central, automation\"}],[\"$\",\"meta\",\"4\",{\"name\":\"creator\",\"content\":\"Neil Haddley\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:title\",\"content\":\"Neil Haddley - Developer \u0026 Technical Consultant\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:description\",\"content\":\"I help organizations to connect with clients, comply with regulations, and automate workflows.\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:url\",\"content\":\"https://haddley.github.io/\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:site_name\",\"content\":\"Neil Haddley\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:locale\",\"content\":\"en_US\"}],[\"$\",\"meta\",\"10\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:title\",\"content\":\"Neil Haddley - Developer \u0026 Technical Consultant\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:description\",\"content\":\"I help organizations to connect with clients, comply with regulations, and automate workflows.\"}],[\"$\",\"link\",\"14\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}],[\"$\",\"$L13\",\"15\",{}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"e:\"$9:metadata\"\n"])</script></body></html>