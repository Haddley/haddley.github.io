---
title: "Teams Toolkit with Azure"
description: "Get started with Microsoft Teams app development using Azure."
date: "2021-05-29"
categories: ["Microsoft 365"]
tags: ""
slug: "teamstoolkit"
image: "/assets/images/teams-hi-res-icon-2019.svg"
---


## Visual Studio Extension

Teams Toolkit makes creating Teams Tabs/Azure applications easier.

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-5.12.18-pm-1836x824.png)
*Add Teams Toolkit Extension to Visual Studio Code*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.47.21-pm-294x84.png)
*Click the Teams Toolkit to open Wizard*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.48.08-pm-1468x1114.png)
*Configure Quick Start items*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.49.16-pm-748x282.png)
*Sign-in to M365 account*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.49.23-pm-734x276.png)
*Sign-in to Azure*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.49.33-pm-726x330.png)
*Click Create New Project link*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.49.49-pm-1264x352.png)
*Start from a sample*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.50.08-pm-1226x514.png)
*Select the Todo List with backend on Azure sample*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.52.34-pm-534x552.png)
*Download the sample code from Github*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.53.04-pm-1334x464.png)
*Notice that the sample code is a work in progress*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.54.00-pm-574x124.png)
*Open Command Palette*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.54.51-pm-1240x160.png)
*Use Team: Provision in the Cloud command to configure Azure*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.55.24-pm-1252x210.png)
*Enter a hard to guess database administrator account name*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.56.06-pm-530x780.png)
*Configures Azure Services*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-3.56.20-pm-970x336.png)
*Provisioning progress*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.09.03-pm-1836x1083.png)
*Newly created resource group*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.09.28-pm-1718x670.png)
*Open SQL Database to copy "Server name"*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.10.16-pm-992x834.png)
*Open Azure Data Studio and enter SQL Server connection details*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.10.32-pm-998x838.png)
*Ensure that Azure firewall rule is added*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.12.32-pm-1102x714.png)
*Use a Query tab in Azure Data Studio to create the Todo list*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.19.44-pm-1234x158.png)
*Use Teams: Deploy to the Cloud command*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.19.52-pm-1248x264.png)
*Deploy the React code and the Azure Function (API)*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.23.48-pm-1258x166.png)
*Use Teams: Build Teams Package command*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.25.03-pm-1242x164.png)
*Use Teams: Publish to Teams command*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.25.13-pm-1230x334.png)
*Install to organization*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.26.40-pm-1836x903.png)
*Open Microsoft Teams admin center. Locate app "pending approval"*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.26.58-pm-1484x896.png)
*Publish app*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.27.08-pm-1210x510.png)
*Click the Publish button*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.28.34-pm-682x388.png)
*App has been added to Microsoft Teams*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.29.15-pm-1188x616.png)
*Use Add to a team button*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.29.28-pm-1262x714.png)
*Select a Team (click Set up a tab)*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.29.55-pm-1224x1230.png)
*View tab configuration page*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.30.25-pm-920x510.png)
*Welcome page click Start to progress*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.30.56-pm-912x590.png)
*Login is required*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.31.12-pm-876x972.png)
*Provide consent*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.31.30-pm-1836x1357.png)
*If no tasks to display*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.32.02-pm-1740x328.png)
*Add task (press enter)*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.32.16-pm-1758x462.png)
*using map to render all of the tasks*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.35.11-pm-1836x977.png)
*A row has been added to the database*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.42.13-pm-1836x1181.png)
*The function app is used to implement a REST api*

![](/assets/images/teamstoolkit/screen-shot-2021-05-29-at-4.45.25-pm-1836x1182.png)
*Tab.js*


## An extract from Tab.js

```text
{this.state.showLoginPage === true && <div className="auth">
          <Profile userInfo={this.state.userInfo} />
          <h2>Welcome to To Do List App!</h2>
          <Button primary onClick={() => this.loginBtnClick()}>Start</Button>
        </div>}
```

## Profile.js

```text
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.

import React from 'react';
import './Profile.css';
import defaultPhoto from '../images/default-photo.png'

class Profile extends React.Component {
  render() {
    return (
      <div className="profile">
        <div className="photo">
          <img src={defaultPhoto} alt="avatar"/>
        </div>
        <div className="info">
          <div className="name">{this.props.userInfo.displayName}</div>
          <div className="email">{this.props.userInfo.preferredUserName}</div>
        </div>
      </div>
    );
  }
}

export default Profile;
```

## An extract from Tab.js

```text
async componentDidMount() {
    await this.initTeamsFx();
    await this.initData();
  }

  async initTeamsFx() {
    // Initialize configuration from environment variables and set the global instance
    loadConfiguration({
      authentication: {
        initiateLoginEndpoint: process.env.REACT_APP_START_LOGIN_PAGE_URL,
        simpleAuthEndpoint: process.env.REACT_APP_TEAMSFX_ENDPOINT,
        clientId: process.env.REACT_APP_CLIENT_ID
      },
      resources: [
        {
          type: ResourceType.API,
          name: "default",
          properties: {
            endpoint: process.env.REACT_APP_FUNC_ENDPOINT
          }
        }
      ]
    });
    const credential = new TeamsUserCredential();
    // Get the user info from access token
    const userInfo = await credential.getUserInfo();

    this.setState({
      userInfo: userInfo
    });

    this.credential = credential;
    this.scope = ["User.Read", "User.ReadBasic.All"];
    this.channelOrChatId = await this.getChannelOrChatId();
  }

  async initData() {
    if (!await this.checkIsConsentNeeded()) {
      await this.getItems();
    }
  }

  async loginBtnClick() {
    try {
      // Popup login page to get user's access token
      await this.credential.login(this.scope);
    } catch (err) {
      alert("Login failed: " + err);
      return;
    }
    await this.initData();
  }

  async checkIsConsentNeeded() {
    try {
      await this.credential.getToken(this.scope);
    } catch (error) {
      this.setState({
        showLoginPage: true
      });
      return true;
    }
    this.setState({
      showLoginPage: false
    });
    return false;
  }
```

## An extract from Tab.js

```text
{this.state.initialized && !this.state.items.length && !this.state.isAddingItem && <div className="no-item">
                <div>
                  <img src={noItemimage} alt="no item" />
                </div>
                <div>
                  <h2>No tasks</h2>
                  <p>Add more tasks to make you day productive.</p>
                </div>
              </div>}
```

## An extract from Tab.js

```text
{this.state.isAddingItem && <div className="item add">
                <div className="complete">
                  <Checkbox
                    disabled
                    className="is-completed-input"
                  />
                </div>
                <div className="description">
                  <Input
                    autoFocus
                    type="text"
                    value={this.state.newItemDescription}
                    onChange={(e) => this.setState({ newItemDescription: e.target.value })}
                    onKeyDown={(e) => {
                      if (e.key === 'Enter') {
                        this.onAddItem();
                      }
                    }}
                    onBlur={() => {
                      if (this.state.newItemDescription) {
                        this.onAddItem();
                      }
                      this.setState({
                        isAddingItem: false,
                      });
                    }}
                    className="text"
                  />
                </div>
              </div>}
```

## An extract from Tab.js

```text
const items = this.state.items?.map((item, index) =>
      <div key={index} className="item">
        <div className="complete">
          <Checkbox
            checked={this.state.items[index].isCompleted}
            onChange={(e, { checked }) => this.onCompletionStatusChange(item.id, index, checked)}
            className="is-completed-input"
          />
        </div>
        <div className="description">
          <Input
            value={this.state.items[index].description}
            onChange={(e) => this.handleInputChange(index, "description", e.target.value)}
            onKeyDown={(e) => {
              if (e.key === 'Enter') {
                this.onUpdateItem(item.id, this.state.items[index].description);
                e.target.blur();
              }
            }}
            onBlur={() => this.onUpdateItem(item.id, this.state.items[index].description)}
            className={"text" + (this.state.items[index].isCompleted ? " is-completed" : "")}
          />
        </div>
        <Creator objectId={item.objectId} credential={this.credential} scope={this.scope} />
        <div className="action">
          <MenuButton
            trigger={<Button content="..." />}
            menu={[
              {
                content: 'Delete',
                onClick: () => this.onDeleteItem(item.id)
              }
            ]}
            on="click"
          />
        </div>
      </div>
    );
```

## index.js

```text
// Copyright (c) Microsoft Corporation.
// Licensed under the MIT License.

const {
    loadConfiguration,
    OnBehalfOfUserCredential,
    DefaultTediousConnectionConfiguration,
} = require("@microsoft/teamsfx");
const { Connection, Request } = require('tedious');

/**
 * This function handles requests sent from teamsfx client SDK.
 * The HTTP request should contain an SSO token in the header and any content in the body.
 * The SSO token should be queried from Teams client by teamsfx client SDK.
 * Before trigger this function, teamsfx binding would process the SSO token and generate teamsfx configuration.
 *
 * This function initializes the teamsfx Server SDK with the configuration and calls these APIs:
 * - getUserInfo() - Get the user's information from the received SSO token.
 * - getMicrosoftGraphClientWithUserIdentity() - Get a graph client to access user's Microsoft 365 data.
 *
 * The response contains multiple message blocks constructed into a JSON object, including:
 * - An echo of the request body.
 * - The display name encoded in the SSO token.
 * - Current user's Microsoft 365 profile if the user has consented.
 *
 * @param {Context} context - The Azure Functions context object.
 * @param {HttpRequest} req - The HTTP request.
 * @param {teamsfxConfig} config - The teamsfx configuration generated by teamsfx binding.
 */
module.exports = async function (context, req, config) {
    let connection;
    // Initialize configuration from environment variables and set the global instance
    loadConfiguration()
    try {
        connection = await getSQLConnection();
        const method = req.method.toLowerCase();
        const accessToken = config.AccessToken;
        const credential = new OnBehalfOfUserCredential(accessToken);
        // Get the user info from access token
        const currentUser = await credential.getUserInfo();
        const objectId = currentUser.objectId;
        var query;

        switch (method) {
            case "get":
                query = `select id, description, isCompleted, objectId from dbo.Todo where channelOrChatId = '${req.query.channelOrChatId}'`;
                break;
            case "put":
                if (req.body.description) {
                    query = `update dbo.Todo set description = N'${req.body.description}' where id = ${req.body.id}`;
                } else {
                    query = `update dbo.Todo set isCompleted = ${req.body.isCompleted ? 1 : 0} where id = ${req.body.id}`;
                }
                break;
            case "post":
                query = `insert into dbo.Todo (description, objectId, isCompleted, channelOrChatId) values (N'${req.body.description}','${objectId}',${req.body.isCompleted ? 1 : 0},'${req.body.channelOrChatId}')`;
                break;
            case "delete":
                query = "delete from dbo.Todo where " + (req.body ? `id = ${req.body.id}` : `objectId = '${objectId}'`);
                break;
        }
        // Execute SQL through TeamsFx server SDK generated connection and return result
        const result = await execQuery(query, connection);
        return {
            status: 200,
            body: result
        }
    }
    catch (err) {
        return {
            status: 500,
            body: {
                error: err.message
            }
        }
    }
    finally {
        if (connection) {
            connection.close();
        }
    }
}

async function getSQLConnection() {
    const sqlConnectConfig = new DefaultTediousConnectionConfiguration();
    const config = await sqlConnectConfig.getConfig();
    const connection = new Connection(config);
    return new Promise((resolve, reject) => {
        connection.on('connect', err => {
            if (err) {
                reject(err);
            }
            resolve(connection);
        })
        connection.on('debug', function (err) {
            console.log('debug:', err);
        });
    })
}

async function execQuery(query, connection) {
    return new Promise((resolve, reject) => {
        const res = [];
        const request = new Request(query, (err) => {
            if (err) {
                reject(err);
            }
        });

        request.on('row', columns => {
            const row = {};
            columns.forEach(column => {
                row[column.metadata.colName] = column.value;
            });
            res.push(row)
        });

        request.on('requestCompleted', () => {
            resolve(res)
        });

        request.on("error", err => {
            reject(err);
        });

        connection.execSql(request);
    })
}
```
## References

- [Teams Toolkit](https://docs.microsoft.com/en-us/microsoftteams/platform/get-started/prerequisites?tabs=vscode)